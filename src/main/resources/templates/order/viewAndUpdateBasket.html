<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout (~{::body},'shop')}">
<body>

<section class="middle-align">
    <div class="container">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="row" th:if="${basket.isEmpty()}">
                    <h3>No items in your basket</h3>
                </div>
                <form action="/basket" method="post" th:object="${basket}">
                    <div class="row" style="margin: 1em" th:unless="${basket.isEmpty()}">
                        <div class="col-4">Product:</div>
                        <div class="col-3">Quantity:</div>
                        <div class="col-4">Total for quantity</div>
                        <div class="col-1"></div>
                    </div>
                    <div class="row" th:each="entry : *{productsInBasket.entrySet()}">
                        <div class="col-4"
                             th:text="${productMap.get(entry.key).getName()}">
                        </div>
                        <div class="col-3">
                            <input class="form-control"
                                   type="text"
                                   th:field="*{productsInBasket[__${entry.key}__]}">
                        </div>
                        <div th:with="qty = ${basket.getProductsInBasket().get(entry.key)}"
                             class="col-4">
                                    <span th:with="price = ${productMap.get(entry.key).getBestPriceForQuantity(__${qty}__)}"
                                          th:text="' x ' + ${price} + ' DKK = ' + (${price} * ${qty}) + ' DKK'"></span>
                        </div>
                        <div class="col-1">
                            <a th:href="'/basket/delete/' + ${entry.key}">Remove</a>
                        </div>
                    </div>
                    <div class="row">
                        <span th:text="'Total = ' + ${total} + ' DKK'"></span>
                    </div>
                    <button type="submit" class="btn btn-info">Update</button>
                </form>
            </div>
        </div>
    </div>
    </div>
</section>
</body>
</html>
