<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout (~{::body},'shop')}">
<body>

<div class="container">
    <div class="row products-row">
        <div class="col-8 mx-auto">
        <form action="/shop" method="get" class="input-group">
            <input class="form-control form-control-dark" type="text" placeholder="Search" name="search"
                   aria-label="Search">
            <div class="input-group-append">
                <button class="btn btn-info" value="Search">Search</button>
            </div>
        </form>
        </div>
    </div>

    <div class="row products-row text-center">
        <div class="col">
            <div class="dropdown">
                <button class="btn btn-info w-100 dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                    Categories
                </button>
                <div class="dropdown-menu w-100" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="/">All Categories</a>
                    <th:block th:each="category : ${allCategories}">
                        <a class="dropdown-item" th:href="'/shop?cat=' + ${category.getId()}" th:text="${category}"></a>
                    </th:block>
                </div>
            </div>
        </div>
        <div class="col">
            <a href="/admin/product/add" class="btn btn-info w-100">Add Product</a>
        </div>
    </div>


    <div class="row products-row text-center justify-content-center">
        <th:block th:if="${noProducts}">
            <h3>No products matched your query</h3>
        </th:block>
        <th:block th:unless="${noProducts}">
        <div class="card card-products rounded bg-dark" style="width: 18rem;" th:each="product: ${products}">
            <img th:src="${product.images.isEmpty()} ? '../images/defaultImage.jpg' : ${product.images[0].url}" class="card-img-top">
            <div class="card-body card-body-product-main">
                <h5 class="card-title product-name"><a th:href="'/product/' + ${product.id}"
                                          th:text="${product.name}"></a></h5>
                <p class="card-text" th:text="${product.description}"></p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item bg-dark"
                    th:text="'Price: ' + (${product.prices.isEmpty()} ? '0!!!' : ${product.prices[0].getPrice()}) + ' DKK'"></li>
                <li class="list-group-item bg-dark" th:text="'Category: ' + ${product.category}"></li>
            </ul>
            <div class="card-body card-body-product-links">
                <a th:href="'/admin/product/edit/' + ${product.id}" class="card-link btn btn-info">Edit</a>
                <a th:href="'/admin/product/delete/' + ${product.id}" class="card-link btn btn-info">Delete</a>
                <form action="/addToBasket" method="post">
                    <input type="hidden" name="productId" th:value="${product.id}">
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="btn btn-primary">Add to cart</button>
                </form>
            </div>
        </div>
        </th:block>
    </div>
</div>
</body>
</html>
